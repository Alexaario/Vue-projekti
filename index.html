<html>
    <head>
        <script src="https://unpkg.com/vue@2.4.3/dist/vue.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
    </head>

    <body>
        <div id="trains">
            <div id="train"></div>
        </div>

        <script defer language="javascript">
            var vm = new Vue({
                el: "#trains",
                data: {
                  trainData: ""
                },

                methods: {
                    getTrainData: function () {
                        let trains = [];

                        axios.get("https://rata.digitraffic.fi/api/v1/live-trains?arrived_trains=0&arriving_trains=0&departed_trains=0&departing_trains=10&station=KE")
                        .then((res) => {
                                trains = res.data;

                                let departing = [];

                                trains.forEach((departures) => {
                                    let trainTimeTable = departures.timeTableRows;

                                    trainTimeTable.forEach((departure) => {
                                        if (departure.type !== "DEPARTURE") return;
                                        if (departure.stationShortCode !== "KE") return;

                                        let date = new Date(departure.scheduledTime).toLocaleString("fi-FI");
                                        departing.push([date, departures]);
                                    });
                                });

                                this.trainData = departing.sort()

                                document.getElementById("train").innerHTML = ""

                                let divMap = departing.map((x) => {
                                  return `<div>
                                            ${x[0]} 
                                            ${x[1].commuterLineID}
                                          </div>`
                                })

                                divMap.forEach(div => {
                                  document.getElementById("train").innerHTML += div
                                });
                            });
                    },
                },

                mounted: function () {
                    this.getTrainData();

                    this.timer = setInterval(() => {
                        this.getTrainData();
                    }, 10000);
                },
            });
        </script>
    </body>
</html>
